<div class="pull-right" style="padding-top: 20px;">

  <div class="dropdown" style="float: left; padding-right: 10px;">
    <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
      Show <%= @duration %> days
      <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
      <% [7, 14, 21, 28].each do |duration| %>
      <li role="presentation"><a style="<%= duration == @duration ? 'font-weight: bold;' : '' %>" role="menuitem" tabindex="-1" href="<%= root_path() %>?duration=<%= duration %>">Show <%= duration %> days</a></li>
      <% end %>
    </ul>
  </div>
</div>

<h2 class="sub-header">Overview</h2>

<h3>Assignments</h3>

<style type="text/css">
  .gantt {
    width: 100%;
  }

  .gantt th {
    font-size: 0.9em;
  }

  .gantt tbody tr td {
    min-width: 250px;
    padding-top: 0.55em;
    padding-bottom: 0.55em;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .gantt thead tr th {
    text-align: center;
  }

  .gantt tbody tr td div {
    /*border: 1px solid #99bccd;
    background-color: rgba(151, 187, 205, 0.4);*/
    border: 1px solid #aaa;
    background-color: #f0f0f0;
    padding: 0.2em;
  }

  .gantt tbody tr td div.continuing {
    border-left: none;
  }

  .gantt-outer {
    overflow-x: scroll;
  }
</style>

<table class="gantt" style="float: left; width: 5%;">
  <thead>
    <tr>
      <th style="min-width: 0;">&nbsp;<!-- developer --></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="padding: 0.8em; text-align: right; min-width: 0;">Christopher</td>
    </tr>
    <tr>
      <td style="padding: 0.8em; text-align: right; min-width: 0;">Lloyd</td>
    </tr>
    <tr>
      <td style="padding: 0.8em; text-align: right; min-width: 0;">Obada</td>
    </tr>
    <tr>
      <td style="padding: 0.8em; text-align: right; min-width: 0;">Eric</td>
    </tr>
  </tbody>
</table>

<div class="gantt-outer">
  <table class="gantt">
    <thead>
      <tr>
        <th>Wed 6/10</th>
        <th>Thu 6/11</th>
        <th>Fri 6/12</th>
        <th>Mon 6/15</th>
        <th>Tue 6/16</th>
        <th>Wed 6/17</th>
        <th>Thu 6/18</th>
        <th>Fri 6/19</th>
        <th>Mon 6/22</th>
        <th>Tue 6/23</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td colspan="2"><div class="continuing">DevBoard: Gantt Charts</div></td>
        <td colspan="2"><div>DW: Banner Activity Import</div></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td colspan="5"><div>IPA: Refactor Instructors/Department Relationship</div></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td colspan="2"><div>IPA: TV HTML</div></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td colspan="5"><div>DSS Messenger: Publisher Modularization</div></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
    </tbody>
  </table>
</div> <!-- .gantt-outer -->

<style text="text/css">
  #progress {
    position: relative;
    padding: 3px;
  }

  #percent {
    position: absolute;
  }

  #bar {
    height: 20px;
    background-color: rgba(151,187,205,0.4);
  }
</style>


<div id="activity-graphs" class="carousel slide" data-ride="carousel" data-interval="false">
  <div class="carousel-inner" role="listbox" style="height: 120%;">
    <div class="item active">
      <div class="row">
        <div class="col-xs-8">
          <h3 class="sub-header">Commits Per Week</h3>
          <div>
        		<canvas id="commits_canvas" height="175" width="500"></canvas>
          </div>
        </div>

        <div class="col-xs-4">
          <h3 class="sub-header">Commits By Project</h3>
          <ul style="list-style-type: none; padding: 0; margin: 0;">
            <% @recent_commits_by_project.each do |project| %>
            <li style="padding: 0; margin: 0;">
              <div id="progress">
                <span id="percent"><%= project[0] %> (<%= project[1] %>)</span>
                <div id="bar" style="width: <%= ((project[1].to_f / @total_commit_count.to_f) * 100.0).to_i %>%"></div>
              </div>
            </li>
            <% end %>
            <li style="padding: 0; margin: 0;">
              <div style="text-align: center;">
                <span><b>Total</b> (<%= @total_commit_count %>)</span>
              </div>
            </li>
          </ul>
        </div>
      </div> <!-- .row -->
    </div>
    <div class="item">
      <div class="row">
        <div class="col-xs-8">
          <h3 class="sub-header">Lines Per Week</h3>
          <div>
        		<canvas id="lines_canvas" height="175" width="500"></canvas>
          </div>
        </div>

        <div class="col-xs-4">
          <h3 class="sub-header">Lines By Project</h3>
          <ul style="list-style-type: none; padding: 0; margin: 0;">
            <% @recent_lines_by_project.each do |project| %>
            <li style="padding: 0; margin: 0;">
              <div id="progress">
                <span id="percent"><%= project[0] %> (<%= project[1] %>)</span>
                <div id="bar" style="width: <%= ((project[1].to_f / @total_commit_count.to_f) * 100.0).to_i %>%"></div>
              </div>
            </li>
            <% end %>
            <li style="padding: 0; margin: 0;">
              <div style="text-align: center;">
                <span><b>Total</b> (<%= @total_commit_count %>)</span>
              </div>
            </li>
          </ul>
        </div>
      </div> <!-- .row -->
    </div>
  </div>

  <div style="text-align: center;">
    <a href="#" data-target="#activity-graphs" data-slide-to="0" class="active">By Commits</a> | <a href="#" data-target="#activity-graphs" data-slide-to="1">By Lines</a>
  </div>
</div>

<script type="text/javascript">
  var commitChartData = {
			labels : [
        <%= @recent_commits_graph.map{ |timestamp, commits| "'" + Date.strptime(timestamp.to_s, "%Y%j").strftime("%A %_m-%e") + "'" }.join(",").html_safe %>
      ],
			datasets : [
				{
					label: "Commits",
          fillColor: "rgba(151,187,205,0.2)",
          strokeColor: "rgba(151,187,205,1)",
          pointColor: "rgba(151,187,205,1)",
          pointStrokeColor: "#fff",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(151,187,205,1)",
          data : [<%= @recent_commits_graph.map{ |timestamp, commits| commits }.join(",") %>]
				}
			]
		}

  var lineChartData = {
			labels : [
        <%= @recent_lines_graph.map{ |timestamp, commits| "'" + Date.strptime(timestamp.to_s, "%Y%j").strftime("%A %_m-%e") + "'" }.join(",").html_safe %>
      ],
			datasets : [
				{
					label: "Commits",
          fillColor: "rgba(151,187,205,0.2)",
          strokeColor: "rgba(151,187,205,1)",
          pointColor: "rgba(151,187,205,1)",
          pointStrokeColor: "#fff",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(151,187,205,1)",
          data : [<%= @recent_lines_graph.map{ |timestamp, lines| lines }.join(",") %>]
				}
			]
		}

    ready = function() {
  		var commits_ctx = document.getElementById("commits_canvas").getContext("2d");

  		window.commitsChart = new Chart(commits_ctx).Line(commitChartData, {
  			responsive: true
  		});

  		var lines_ctx = document.getElementById("lines_canvas").getContext("2d");

  		window.linesChart = new Chart(lines_ctx).Line(lineChartData, {
  			responsive: true
  		});
  	};

    $(document).ready(ready);
    $(document).on('page:load', ready);

    $('#activity-graphs').on('slid.bs.carousel', function () {
      $("#commits_canvas").width(500).height(175);
      $("#lines_canvas").width(500).height(175);
      ready();
    });
</script>

<h3 class="sub-header">Commit Messages</h3>

<div class="table-responsive">
<table class="table table-striped table-condensed">
  <thead>
    <tr>
      <th class="col-xs-2">When</th>
      <th class="col-xs-2">Project</th>
      <th class="col-xs-2">Developer</th>
      <th class="col-xs-8">Message</th>
    </tr>
  </thead>
  <tbody>
    <% @commits.each do |commit| %>
    <tr>
      <td><%= time_ago_in_words(commit.committed_at) %> ago</td>
      <td><%= commit.project.name %></td>
      <td><%= commit.account.developer.nil? ? "Unknown" : commit.account.developer.name %></td>
      <td><%= commit.message %></td>
    </tr>
    <% end %>
  </tbody>
</table>
</div>




















<!-- Original view code -->

<h3 class="sub-header">Projects</h3>

<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Status</th>
        <th>Name</th>
        <th>Task Ratio</th>
        <th>Age</th>
      </tr>
    </thead>
    <tbody>
      <%# [0, 1, 2, 3] are all in progress or in production statuses. Be nice to not have to magic number it up. %>
      <% Project.where(:status => [0, 1, 2, 3]).order(:status).each do |project| %>
      <tr>
        <td><%= project_status_in_words(project.status) %></td>
        <td><%= link_to project.name, project %></td>
        <td><%= (project.tasks.count > 0) ? ((project.tasks.where(completed: nil).count / project.tasks.count) * 100).to_s + '%' : 'N/A' %></td>
        <td><%= time_ago_in_words(project.began) %></td>
      </tr>
      <% end %>
    </tbody>
  </table>
</div>

<br /><br /><br />

<h3 class="sub-header">Tasks</h3>

<%# Only show 'Past Due' tasks if any exist %>
<% if @past_due_tasks.length > 0 %>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th colspan="2">Past Due</th>
      </tr>
    </thead>
    <tbody>
      <% @past_due_tasks.each do |task| %>
      <tr>
        <td><%= link_to (task.project.nil? ? "No project" : task.project.name) + ':', task.project %> <%= link_to task.title, task %></td>
        <td><%= time_ago_in_words(task.due) %> ago</td>
      </tr>
      <% end %>
    </tbody>
  </table>
</div>
<% end %>

<%# Only show 'Due Soon' tasks if any exist %>
<% if @due_soon_tasks.length > 0 %>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th colspan="2">Due Soon</th>
      </tr>
    </thead>
    <tbody>
      <% @due_soon_tasks.each do |task| %>
      <tr>
        <td><%= link_to task.project.name + ':', task.project %> <%= link_to task.title, task %></td>
        <td><%= time_ago_in_words(task.due) %> from now</td>
      </tr>
      <% end %>
    </tbody>
  </table>
</div>
<% end %>

<%# Only show 'No Due Date' tasks if any exist %>
<% if @no_due_date_tasks.length > 0 %>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Issues with no Due Date</th>
      </tr>
    </thead>
    <tbody>
      <% @no_due_date_tasks.each_with_index do |task, i| %>
      <tr>
        <td><%= link_to task.project.name + ':', task.project %> <%= link_to task.title, task %></td>
      </tr>
      <% if i == 5 %>
      <tr>
        <td><center><%= link_to 'Show More...', tasks_url %></center></td>
      </tr>
      <% break %>
      <% end %>
      <% end %>
    </tbody>
  </table>
</div>
<% end %>

<br /><br /><br />

<h3 class="sub-header">Developers</h3>

number of projects in production, closed
what each developer is working on
each developer's commits, task count in the last week
what's due soon
what's overdue


<h2 class="sub-header">Activity</h2>
<div class="table-responsive">
  <table class="table table-striped">
    <tbody>
      <% @activities.each do |activity| %>
      <tr>
        <td><%= activity_to_s(activity) %></td>
        <td><%= time_ago_in_words(activity.when) %> ago</td>
      </tr>
      <% end %>
    </tbody>
  </table>
</div>
